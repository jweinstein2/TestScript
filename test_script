#!/bin/bash
ASSIGNMENT=4
NAME="Merge16"
LOCAL="./$NAME"
STAN="/c/cs223/Hwk$ASSIGNMENT/$NAME"
MYDIR="$(dirname "$(realpath "$0")")/tests"

i=0
failed=0
passed=0

if [[ "$1" = *"r"* ]]
then
	shouldPrintResults=1
else
	shouldPrintResults=0
fi

echo "===== testing ======="

while read line           
do
	if [[ $line != "#"* ]]
	then
		((i=i+1))
		PROG=$LOCAL
		myAns=$(eval "valgrind -q $line")
		PROG=$STAN  
		stanAns=$(eval "$line")

		if [ "$myAns" = "$stanAns" ]
		then
			((passed=passed+1))
			echo "Test$i passed"
		else
			((failed=failed+1))
			if [ $shouldPrintResults = 1 ]
			then
				echo "===== Test$i failed ======="
				(PROG=$LOCAL; echo $line)
				echo "Your output  : $myAns"
				echo "Stan's Output: $stanAns"
				echo "==========================="
			fi
		fi
	fi
done <$MYDIR

echo "==== Final Results ===="
echo "       passed - $passed"
echo "       failed - $failed"
